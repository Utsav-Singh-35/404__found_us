{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trending - SatyaMatrix</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/chat.css' %}">
    <link rel="stylesheet" href="{% static 'css/trending.css' %}">
</head>

<body>
    <!-- Left Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="menu-btn" id="menuToggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <span class="sidebar-title">Menu</span>
        </div>
        
        <div class="sidebar-top">
            <a href="/auth/chat/" class="sidebar-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"></path>
                </svg>
                <span class="sidebar-text">New Chat</span>
            </a>
            
            <a href="/auth/chat/" class="sidebar-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <span class="sidebar-text">Current Chat</span>
            </a>
            
            <a href="/auth/chat/" class="sidebar-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="sidebar-text">History</span>
            </a>
            
            <a href="/auth/trending/" class="sidebar-item active">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                </svg>
                <span class="sidebar-text">Trending</span>
            </a>
        </div>
        
        <div class="sidebar-bottom">
            <button class="sidebar-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
                </svg>
                <span class="sidebar-text">Settings</span>
            </button>
            
            <a href="{% url 'profile' %}" class="sidebar-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span class="sidebar-text">Profile</span>
            </a>
            
            <button class="sidebar-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span class="sidebar-text">About</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- 3D Scene Container -->
        <div id="canvas-container"></div>

        <!-- NASA Mission Control Content -->
        <div class="nasa-container">
            <!-- Header -->
            <header class="nasa-header">
                <div class="nasa-logo">
                    <img src="{% static 'assects/icons/satyamatrix.svg' %}" alt="SatyaMatrix">
                </div>
                <div class="nasa-search-bar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 3a9 9 0 0 1 9 9 9 9 0 0 1-9 9 9 9 0 0 1-9-9 9 9 0 0 1 9-9z"></path>
                        <path d="M12 8v8m-4-4h8"></path>
                    </svg>
                    <span>New Chat</span>
                </div>
                        <div class="user-dropdown">
            <button class="user-btn" id="userBtn">
                <div class="user-avatar-small">{{ user.name|slice:":2"|upper }}</div>
                <span>{{ user.name }}</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="dropdown-menu" id="dropdownMenu">
                <a href="{% url 'profile' %}" class="dropdown-item">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    Profile
                </a>
                <a href="#" class="dropdown-item">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                    </svg>
                    Settings
                </a>
                <div class="dropdown-divider"></div>
                <a href="{% url 'logout' %}" class="dropdown-item logout">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </a>
            </div>
        </div>
            </header>

            <!-- Main Content Area -->
            <div class="nasa-main-section">
                <!-- Floating Globe UI -->
                <div class="globe-ui-wrapper">
                    <!-- Info Card -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <span>Your Location</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </div>
                        <div class="stat-grid">
                            <div class="stat-item">
                                <label>City</label>
                                <span class="text-cyan" id="userCity">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <label>State</label>
                                <span id="userState">--</span>
                            </div>
                            <div class="stat-item">
                                <label>Latitude</label>
                                <span id="userLat">--</span>
                            </div>
                            <div class="stat-item">
                                <label>Longitude</label>
                                <span id="userLon">--</span>
                            </div>
                        </div>
                        <div class="stat-item" style="margin-top: 15px;">
                            <label>Trending region</label>
                            <span class="text-green" id="trendingRegion">Detecting...</span>
                        </div>
                        <div class="arrow-circle">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Bottom Widgets -->
                <div class="dashboard-row">
                    <!-- Widget 1 -->
                    <div class="glass-panel">
                        <div class="panel-header">
                            <span>Misinformation By Category</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="7" y1="17" x2="17" y2="7"></line>
                                <polyline points="7 7 17 7 17 17"></polyline>
                            </svg>
                        </div>
                        <div style="font-size:24px; font-weight:700; margin-bottom:5px;">1900 <span style="font-size:12px; font-weight:400; color:#888;">Reports</span></div>
                        <div class="chart-area">
                            <div class="bar-col">
                                <div class="bar active" style="height:90px;"></div>
                                <span class="bar-lbl">Politics</span>
                            </div>
                            <div class="bar-col">
                                <div class="bar" style="height:60px;"></div>
                                <span class="bar-lbl">Health</span>
                            </div>
                            <div class="bar-col">
                                <div class="bar" style="height:35px;"></div>
                                <span class="bar-lbl">Communal</span>
                            </div>
                            <div class="bar-col">
                                <div class="bar" style="height:15px;"></div>
                                <span class="bar-lbl">Climate</span>
                            </div>
                            <div class="bar-col">
                                <div class="bar" style="height:10px;"></div>
                                <span class="bar-lbl">Scam</span>
                            </div>
                        </div>
                    </div>

                    <!-- Widget 2 -->
                    <div class="glass-panel">
                        <div class="panel-header">
                            <span>Daily Misinformation Volume</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="7" y1="17" x2="17" y2="7"></line>
                                <polyline points="7 7 17 7 17 17"></polyline>
                            </svg>
                        </div>
                        <div style="margin-top:5px;">
                            <div class="list-row">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <span class="date-pill">8:10 PM</span>
                                    <div>
                                        <div style="font-size:13px; font-weight:500;">Viral health rumor</div>
                                        <div style="font-size:11px; color:#888;">Spreading rapidly</div>
                                    </div>
                                </div>
                                <div style="font-size:11px; color:#ff6b6b;">üî¥ High</div>
                            </div>
                            <div class="list-row">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <span class="date-pill">7:42 PM</span>
                                    <div>
                                        <div style="font-size:13px; font-weight:500;">Political claim trending</div>
                                        <div style="font-size:11px; color:#888;">Fact-check pending</div>
                                    </div>
                                </div>
                                <div style="font-size:11px; color:#ffa500;">‚ö†Ô∏è Med</div>
                            </div>
                            <div class="list-row">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <span class="date-pill">6:59 PM</span>
                                    <div>
                                        <div style="font-size:13px; font-weight:500;">Edited image circulating</div>
                                        <div style="font-size:11px; color:#888;">Deepfake detected</div>
                                    </div>
                                </div>
                                <div style="font-size:11px; color:#ff6b6b;">üî¥ High</div>
                            </div>
                            <div class="list-row" style="border:none; padding-top:8px;">
                                <a href="#" style="display:flex; align-items:center; gap:6px; color:var(--nasa-accent-cyan); text-decoration:none; font-size:12px; font-weight:500; transition:opacity 0.3s;">
                                    <span>View More</span>
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                        <polyline points="12 5 19 12 12 19"></polyline>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Widget 3 -->
                    <div class="glass-panel">
                        <div class="panel-header">
                            <span>Narrative Breakdown (NRI)</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="7" y1="17" x2="17" y2="7"></line>
                                <polyline points="7 7 17 7 17 17"></polyline>
                            </svg>
                        </div>
                        <div style="display:flex; flex-direction:column; justify-content:center; flex:1;">
                            <div class="prog-row">
                                <div class="prog-head">
                                    <span>Fear</span>
                                    <span>42%</span>
                                </div>
                                <div class="prog-bg">
                                    <div class="prog-fill" style="width:42%; background:#ff6b6b;"></div>
                                </div>
                            </div>
                            <div class="prog-row">
                                <div class="prog-head">
                                    <span>Blame</span>
                                    <span>18%</span>
                                </div>
                                <div class="prog-bg">
                                    <div class="prog-fill" style="width:18%; background:#ffa500;"></div>
                                </div>
                            </div>
                            <div class="prog-row">
                                <div class="prog-head">
                                    <span>Conspiracy</span>
                                    <span>15%</span>
                                </div>
                                <div class="prog-bg">
                                    <div class="prog-fill" style="width:15%; background:#9b59b6;"></div>
                                </div>
                            </div>
                            <div class="prog-row">
                                <div class="prog-head">
                                    <span>Communal</span>
                                    <span>13%</span>
                                </div>
                                <div class="prog-bg">
                                    <div class="prog-fill" style="width:13%; background:#e74c3c;"></div>
                                </div>
                            </div>
                            <div class="prog-row">
                                <div class="prog-head">
                                    <span>Manipulation</span>
                                    <span>12%</span>
                                </div>
                                <div class="prog-bg">
                                    <div class="prog-fill" style="width:12%; background:#f39c12;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <aside class="nasa-sidebar">
                <div class="sidebar-panel">
                    <div class="sidebar-head">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                            <polyline points="17 6 23 6 23 12"></polyline>
                        </svg>
                        Most Trending News
                    </div>

                    <!-- News List -->
                    <div class="news-list">
                        <!-- News Item 1 -->
                        <div class="news-item">
                            <div class="news-rank">1</div>
                            <div class="news-content">
                                <div class="news-title">Election Commission announces dates for state polls</div>
                                <div class="news-author">By Rajesh Kumar ‚Ä¢ 2h ago</div>
                                <div class="news-actions">
                                    <button class="action-btn like-btn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                                        </svg>
                                        <span>234</span>
                                    </button>
                                    <button class="action-btn dislike-btn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
                                        </svg>
                                        <span>12</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- News Item 2 -->
                        <div class="news-item">
                            <div class="news-rank">2</div>
                            <div class="news-content">
                                <div class="news-title">New COVID variant detected in multiple states</div>
                                <div class="news-author">By Dr. Priya Sharma ‚Ä¢ 4h ago</div>
                                <div class="news-actions">
                                    <button class="action-btn like-btn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                                        </svg>
                                        <span>189</span>
                                    </button>
                                    <button class="action-btn dislike-btn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
                                        </svg>
                                        <span>45</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- News Item 3 -->
                        <div class="news-item">
                            <div class="news-rank">3</div>
                            <div class="news-content">
                                <div class="news-title">Supreme Court verdict on privacy laws expected today</div>
                                <div class="news-author">By Amit Verma ‚Ä¢ 5h ago</div>
                                <div class="news-actions">
                                    <button class="action-btn like-btn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                                        </svg>
                                        <span>156</span>
                                    </button>
                                    <button class="action-btn dislike-btn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
                                        </svg>
                                        <span>8</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- News Item 4 -->
                        <!-- <div class="news-item">
                            <div class="news-rank">4</div>
                            <div class="news-content">
                                <div class="news-title">Tech giant announces major layoffs amid restructuring</div>
                                <div class="news-author">By Sneha Patel ‚Ä¢ 6h ago</div>
                                <div class="news-actions">
                                    <button class="action-btn like-btn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                                        </svg>
                                        <span>142</span>
                                    </button>
                                    <button class="action-btn dislike-btn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
                                        </svg>
                                        <span>23</span>
                                    </button>
                                </div>
                            </div>
                        </div> -->
                    </div>

                    <!-- View All Button -->
                    <button class="view-all-btn" id="viewAllNewsBtn">
                        <span>View All News</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </button>
                </div>
            </aside>
        </div>

        <!-- Full Screen News Modal -->
        <div class="news-modal" id="newsModal">
            <div class="news-modal-overlay" id="newsModalOverlay"></div>
            <div class="news-modal-content">
                <div class="news-modal-header">
                    <h2>All Trending News</h2>
                    <button class="news-modal-close" id="closeNewsModal">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="news-modal-body">
                    <div class="news-grid">
                        <div class="news-card"><div class="news-card-rank">1</div><h3 class="news-card-title">Election Commission announces dates for state polls</h3><p class="news-card-author">By Rajesh Kumar ‚Ä¢ 2h ago</p><p class="news-card-excerpt">The Election Commission has announced the schedule for upcoming state assembly elections across five states...</p><div class="news-card-actions"><button class="action-btn like-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg><span>234</span></button><button class="action-btn dislike-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg><span>12</span></button></div></div>
                        <div class="news-card"><div class="news-card-rank">2</div><h3 class="news-card-title">New COVID variant detected in multiple states</h3><p class="news-card-author">By Dr. Priya Sharma ‚Ä¢ 4h ago</p><p class="news-card-excerpt">Health officials have confirmed the presence of a new COVID-19 variant in several states...</p><div class="news-card-actions"><button class="action-btn like-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg><span>189</span></button><button class="action-btn dislike-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg><span>45</span></button></div></div>
                        <div class="news-card"><div class="news-card-rank">3</div><h3 class="news-card-title">Supreme Court verdict on privacy laws expected today</h3><p class="news-card-author">By Amit Verma ‚Ä¢ 5h ago</p><p class="news-card-excerpt">The Supreme Court is set to deliver its landmark judgment on digital privacy laws...</p><div class="news-card-actions"><button class="action-btn like-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg><span>156</span></button><button class="action-btn dislike-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg><span>8</span></button></div></div>
                        <div class="news-card"><div class="news-card-rank">4</div><h3 class="news-card-title">Tech giant announces major layoffs amid restructuring</h3><p class="news-card-author">By Sneha Patel ‚Ä¢ 6h ago</p><p class="news-card-excerpt">A leading technology company has announced plans to lay off thousands of employees...</p><div class="news-card-actions"><button class="action-btn like-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg><span>142</span></button><button class="action-btn dislike-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg><span>23</span></button></div></div>
                        <div class="news-card"><div class="news-card-rank">5</div><h3 class="news-card-title">Climate summit reaches historic agreement on emissions</h3><p class="news-card-author">By Kavita Menon ‚Ä¢ 8h ago</p><p class="news-card-excerpt">World leaders have reached a groundbreaking agreement on reducing carbon emissions...</p><div class="news-card-actions"><button class="action-btn like-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg><span>128</span></button><button class="action-btn dislike-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg><span>15</span></button></div></div>
                        <div class="news-card"><div class="news-card-rank">6</div><h3 class="news-card-title">Stock market hits all-time high on positive economic data</h3><p class="news-card-author">By Rohan Desai ‚Ä¢ 10h ago</p><p class="news-card-excerpt">The stock market reached record highs today following the release of encouraging economic indicators...</p><div class="news-card-actions"><button class="action-btn like-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg><span>95</span></button><button class="action-btn dislike-btn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg><span>7</span></button></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed News Modal -->
        <div class="detailed-news-modal" id="detailedNewsModal">
            <div class="detailed-news-overlay" id="detailedNewsOverlay"></div>
            <div class="detailed-news-content">
                <button class="detailed-news-close" id="closeDetailedNews">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
                <div class="detailed-news-body">
                    <div class="detailed-news-header">
                        <div class="detailed-news-rank" id="detailRank">1</div>
                        <h1 class="detailed-news-title" id="detailTitle">News Title</h1>
                    </div>
                    <div class="detailed-news-meta">
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span id="detailAuthor">Author Name</span>
                        </div>
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <span id="detailTime">2 hours ago</span>
                        </div>
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span id="detailLocation">Mumbai, India</span>
                        </div>
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <span id="detailDate">Nov 27, 2025</span>
                        </div>
                    </div>
                    <div class="detailed-news-description">
                        <h3>News Description</h3>
                        <p id="detailDescription">Full news description will appear here...</p>
                    </div>
                    <div class="detailed-news-report">
                        <h3>Detailed Analysis</h3>
                        <p id="detailReport">Comprehensive analysis and fact-check report of this news item. This section includes verification status, source credibility, narrative analysis, and community feedback...</p>
                    </div>
                    <div class="detailed-news-actions">
                        <button class="download-report-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Download Detailed Report
                        </button>
                        <div class="detailed-actions-group">
                            <button class="action-btn like-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                                </svg>
                                <span id="detailLikes">234</span>
                            </button>
                            <button class="action-btn dislike-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
                                </svg>
                                <span id="detailDislikes">12</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Sidebar toggle""
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        
        if (menuToggle && sidebar) {
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('expanded');
            });
        }

        // User dropdown toggle
        const userBtn = document.getElementById('userBtn');
        const dropdownMenu = document.getElementById('dropdownMenu');
        
        if (userBtn && dropdownMenu) {
            userBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!userBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                    dropdownMenu.classList.remove('active');
                }
            });
        }

        // Get user's live location
        async function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Update coordinates
                        document.getElementById('userLat').textContent = lat.toFixed(2) + '¬∞' + (lat >= 0 ? 'N' : 'S');
                        document.getElementById('userLon').textContent = Math.abs(lon).toFixed(2) + '¬∞' + (lon >= 0 ? 'E' : 'W');
                        
                        // Add marker on globe
                        if (window.addLocationMarker) {
                            window.addLocationMarker(lat, lon);
                        }
                        
                        // Try multiple geocoding services
                        let locationFound = false;
                        
                        // Try Method 1: BigDataCloud API
                        try {
                            const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
                            const data = await response.json();
                            
                            console.log('BigDataCloud data:', data);
                            
                            if (data && (data.city || data.locality)) {
                                const city = data.city || data.locality || data.localityInfo?.administrative?.[3]?.name;
                                const state = data.principalSubdivision || data.localityInfo?.administrative?.[1]?.name;
                                
                                if (city) {
                                    document.getElementById('userCity').textContent = city;
                                    document.getElementById('userState').textContent = state || data.countryName || '--';
                                    document.getElementById('trendingRegion').textContent = city + (state ? ', ' + state : '');
                                    locationFound = true;
                                }
                            }
                        } catch (error) {
                            console.error('BigDataCloud error:', error);
                        }
                        
                        // Try Method 2: Nominatim if first method failed
                        if (!locationFound) {
                            try {
                                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10`);
                                const data = await response.json();
                                
                                console.log('Nominatim data:', data);
                                
                                if (data && data.address) {
                                    const city = data.address.city || data.address.town || data.address.village || data.address.municipality || data.address.county;
                                    const state = data.address.state || data.address.region;
                                    
                                    if (city) {
                                        document.getElementById('userCity').textContent = city;
                                        document.getElementById('userState').textContent = state || data.address.country || '--';
                                        document.getElementById('trendingRegion').textContent = city + (state ? ', ' + state : '');
                                        locationFound = true;
                                    }
                                }
                            } catch (error) {
                                console.error('Nominatim error:', error);
                            }
                        }
                        
                        // Fallback if both methods failed
                        if (!locationFound) {
                            document.getElementById('userCity').textContent = 'Location detected';
                            document.getElementById('userState').textContent = 'Unknown area';
                            document.getElementById('trendingRegion').textContent = lat.toFixed(2) + '¬∞, ' + lon.toFixed(2) + '¬∞';
                        }
                    },
                    async (error) => {
                        console.error('Geolocation error:', error);
                        // Fallback to IP-based location
                        try {
                            const response = await fetch('https://ipapi.co/json/');
                            const data = await response.json();
                            
                            if (data.city) {
                                document.getElementById('userCity').textContent = data.city;
                                document.getElementById('userState').textContent = data.region || data.country_name;
                                document.getElementById('userLat').textContent = data.latitude.toFixed(2) + '¬∞' + (data.latitude >= 0 ? 'N' : 'S');
                                document.getElementById('userLon').textContent = Math.abs(data.longitude).toFixed(2) + '¬∞' + (data.longitude >= 0 ? 'E' : 'W');
                                document.getElementById('trendingRegion').textContent = data.city + ', ' + (data.region || data.country_name);
                                document.getElementById('trendingStrength').textContent = 'Moderate Activity';
                            }
                        } catch (ipError) {
                            console.error('IP location error:', ipError);
                            document.getElementById('userCity').textContent = 'Not available';
                            document.getElementById('userState').textContent = '--';
                            document.getElementById('userLat').textContent = '--';
                            document.getElementById('userLon').textContent = '--';
                            document.getElementById('trendingRegion').textContent = 'Enable location';
                            document.getElementById('trendingStrength').textContent = '--';
                        }
                    }
                );
            } else {
                // Browser doesn't support geolocation, try IP-based
                try {
                    const response = await fetch('https://ipapi.co/json/');
                    const data = await response.json();
                    
                    if (data.city) {
                        document.getElementById('userCity').textContent = data.city;
                        document.getElementById('userState').textContent = data.region || data.country_name;
                        document.getElementById('userLat').textContent = data.latitude.toFixed(2) + '¬∞' + (data.latitude >= 0 ? 'N' : 'S');
                        document.getElementById('userLon').textContent = Math.abs(data.longitude).toFixed(2) + '¬∞' + (data.longitude >= 0 ? 'E' : 'W');
                        document.getElementById('trendingRegion').textContent = data.city + ', ' + (data.region || data.country_name);
                        document.getElementById('trendingStrength').textContent = 'Moderate Activity';
                    }
                } catch (error) {
                    document.getElementById('userCity').textContent = 'Not supported';
                    document.getElementById('userState').textContent = '--';
                    document.getElementById('trendingRegion').textContent = 'Browser not supported';
                }
            }
        }

        // Call location function on page load
        getUserLocation();

        // News Modal functionality
        const viewAllNewsBtn = document.getElementById('viewAllNewsBtn');
        const newsModal = document.getElementById('newsModal');
        const closeNewsModal = document.getElementById('closeNewsModal');
        const newsModalOverlay = document.getElementById('newsModalOverlay');

        if (viewAllNewsBtn && newsModal) {
            viewAllNewsBtn.addEventListener('click', () => {
                newsModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });

            closeNewsModal.addEventListener('click', () => {
                newsModal.classList.remove('active');
                document.body.style.overflow = '';
            });

            newsModalOverlay.addEventListener('click', () => {
                newsModal.classList.remove('active');
                document.body.style.overflow = '';
            });
        }

        // Detailed News Modal functionality
        const detailedNewsModal = document.getElementById('detailedNewsModal');
        const closeDetailedNews = document.getElementById('closeDetailedNews');
        const detailedNewsOverlay = document.getElementById('detailedNewsOverlay');

        // News data
        const newsData = {
            1: {
                title: "Election Commission announces dates for state polls",
                author: "Rajesh Kumar",
                time: "2 hours ago",
                date: "Nov 27, 2025",
                location: "New Delhi, India",
                description: "The Election Commission of India has officially announced the schedule for upcoming state assembly elections across five states. The announcement comes after extensive consultations with political parties and state administrations. The elections will be conducted in multiple phases to ensure smooth and fair voting processes.",
                report: "Our fact-checking team has verified this information with official Election Commission sources. The announcement was made during a press conference held at Nirvachan Sadan. All dates have been cross-verified with the official ECI website and press releases. Narrative Analysis: This is a factual administrative announcement with no detected misinformation elements. Source Credibility: Official government source (100% reliable). Community Feedback: 95% users marked this as accurate information.",
                likes: 234,
                dislikes: 12
            },
            2: {
                title: "New COVID variant detected in multiple states",
                author: "Dr. Priya Sharma",
                time: "4 hours ago",
                date: "Nov 27, 2025",
                location: "Mumbai, India",
                description: "Health officials have confirmed the presence of a new COVID-19 variant in several states across India. The variant has been detected through genomic sequencing at ICMR laboratories. Health authorities are monitoring the situation closely and have advised citizens to follow COVID-appropriate behavior.",
                report: "Verified with ICMR and state health departments. The variant has been officially documented in WHO databases. Our medical experts confirm this is accurate reporting based on scientific evidence. Narrative Analysis: Health information verified through official medical channels. No fear-mongering detected. Source Credibility: Medical professional with verified credentials (92% reliable). Community Feedback: 78% users found this informative and accurate.",
                likes: 189,
                dislikes: 45
            },
            3: {
                title: "Supreme Court verdict on privacy laws expected today",
                author: "Amit Verma",
                time: "5 hours ago",
                date: "Nov 27, 2025",
                location: "New Delhi, India",
                description: "The Supreme Court of India is set to deliver its landmark judgment on digital privacy laws that could reshape data protection regulations in the country. The case has been under consideration for several months and involves multiple petitions regarding citizen privacy rights in the digital age.",
                report: "Confirmed through Supreme Court cause list and official court records. Multiple legal experts have been consulted to verify the case details. The hearing schedule matches official court documentation. Narrative Analysis: Factual legal reporting with proper context. Source Credibility: Legal correspondent with court access (88% reliable). Community Feedback: 91% users marked this as credible legal news.",
                likes: 156,
                dislikes: 8
            },
            4: {
                title: "Tech giant announces major layoffs amid restructuring",
                author: "Sneha Patel",
                time: "6 hours ago",
                date: "Nov 27, 2025",
                location: "Bangalore, India",
                description: "A leading technology company has announced plans to lay off thousands of employees as part of a major restructuring initiative. The company cited changing market conditions and the need to streamline operations. Affected employees will receive severance packages and job placement assistance.",
                report: "Verified through official company press release and SEC filings. Multiple employees have confirmed receiving notifications. The numbers match internal company communications. Narrative Analysis: Corporate news verified through official channels. Source Credibility: Business journalist with industry sources (85% reliable). Community Feedback: 82% users confirmed accuracy through multiple sources.",
                likes: 142,
                dislikes: 23
            },
            5: {
                title: "Climate summit reaches historic agreement on emissions",
                author: "Kavita Menon",
                time: "8 hours ago",
                date: "Nov 27, 2025",
                location: "Paris, France",
                description: "World leaders have reached a groundbreaking agreement on reducing carbon emissions at the international climate summit. The agreement includes specific targets for emission reductions and financial commitments from developed nations to support climate action in developing countries.",
                report: "Confirmed through official UN Climate Change website and summit press releases. Multiple country delegations have verified the agreement terms. The document has been published on official channels. Narrative Analysis: Environmental news verified through international official sources. Source Credibility: Environmental correspondent with UN access (94% reliable). Community Feedback: 89% users verified this through multiple international sources.",
                likes: 128,
                dislikes: 15
            },
            6: {
                title: "Stock market hits all-time high on positive economic data",
                author: "Rohan Desai",
                time: "10 hours ago",
                date: "Nov 27, 2025",
                location: "Mumbai, India",
                description: "The stock market reached record highs today following the release of encouraging economic indicators and strong corporate earnings reports. The benchmark indices showed significant gains with broad-based buying across sectors. Market analysts attribute the rally to positive GDP growth data and improved investor sentiment.",
                report: "Verified through official stock exchange data and market indices. Economic indicators cross-checked with government statistics. Multiple financial analysts have confirmed the market movements. Narrative Analysis: Financial news based on verifiable market data. Source Credibility: Financial analyst with market expertise (90% reliable). Community Feedback: 87% users confirmed through real-time market data.",
                likes: 95,
                dislikes: 7
            }
        };

        function openDetailedNews(rank) {
            const news = newsData[rank];
            if (!news) return;

            document.getElementById('detailRank').textContent = rank;
            document.getElementById('detailTitle').textContent = news.title;
            document.getElementById('detailAuthor').textContent = news.author;
            document.getElementById('detailTime').textContent = news.time;
            document.getElementById('detailDate').textContent = news.date;
            document.getElementById('detailLocation').textContent = news.location;
            document.getElementById('detailDescription').textContent = news.description;
            document.getElementById('detailReport').textContent = news.report;
            document.getElementById('detailLikes').textContent = news.likes;
            document.getElementById('detailDislikes').textContent = news.dislikes;

            detailedNewsModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Add click handlers to all news cards
        document.querySelectorAll('.news-card').forEach(card => {
            card.addEventListener('click', (e) => {
                // Don't open if clicking on action buttons
                if (e.target.closest('.action-btn')) return;
                
                const rank = card.querySelector('.news-card-rank').textContent;
                openDetailedNews(parseInt(rank));
            });
            card.style.cursor = 'pointer';
        });

        // Add click handlers to sidebar news items
        document.querySelectorAll('.news-item').forEach(item => {
            item.addEventListener('click', (e) => {
                // Don't open if clicking on action buttons
                if (e.target.closest('.action-btn')) return;
                
                const rank = item.querySelector('.news-rank').textContent;
                openDetailedNews(parseInt(rank));
            });
            item.style.cursor = 'pointer';
        });

        if (closeDetailedNews) {
            closeDetailedNews.addEventListener('click', () => {
                detailedNewsModal.classList.remove('active');
                document.body.style.overflow = '';
            });
        }

        if (detailedNewsOverlay) {
            detailedNewsOverlay.addEventListener('click', () => {
                detailedNewsModal.classList.remove('active');
                document.body.style.overflow = '';
            });
        }

        // Download report functionality
        document.querySelector('.download-report-btn')?.addEventListener('click', () => {
            const title = document.getElementById('detailTitle').textContent;
            const author = document.getElementById('detailAuthor').textContent;
            const date = document.getElementById('detailDate').textContent;
            const description = document.getElementById('detailDescription').textContent;
            const report = document.getElementById('detailReport').textContent;

            const reportContent = `
SATYAMATRIX - DETAILED NEWS REPORT
=====================================

Title: ${title}
Author: ${author}
Date: ${date}
Location: ${document.getElementById('detailLocation').textContent}

DESCRIPTION:
${description}

DETAILED ANALYSIS & FACT-CHECK:
${report}

---
Generated by SatyaMatrix Fact-Checking System
Report Date: ${new Date().toLocaleString()}
            `;

            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SatyaMatrix_Report_${title.substring(0, 30).replace(/[^a-z0-9]/gi, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    </script>

    <!-- Three.js & Globe Logic -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const container = document.getElementById('canvas-container');
        if (container) {
            // Scene Setup
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 18;
            camera.position.y = 0;
            camera.position.x = 0;

            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // Group to hold all globe elements
            const earthGroup = new THREE.Group();
            earthGroup.position.x = -5.5;
            earthGroup.rotation.x = 0.25;
            earthGroup.rotation.y = 4.7 - Math.PI / 2.5;
            scene.add(earthGroup);

            const RADIUS = 5.5;

            // 1. Land Sphere (Black)
            const landSphere = new THREE.Mesh(
                new THREE.SphereGeometry(RADIUS - 0.05, 64, 64),
                new THREE.MeshBasicMaterial({ color: 0x000000 })
            );
            earthGroup.add(landSphere);

            // 2. Ocean Dots (Hologram Effect)
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.src = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_specular_2048.jpg';
            img.onload = function () {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imgData.data;
                const positions = [];
                const step = 3;

                for (let y = 0; y < canvas.height; y += step) {
                    for (let x = 0; x < canvas.width; x += step) {
                        const i = (y * canvas.width + x) * 4;
                        if (data[i] <= 50) {
                            const lat = 90 - (y / canvas.height) * 180;
                            const lon = (x / canvas.width) * 360 - 180;
                            const phi = (90 - lat) * (Math.PI / 180);
                            const theta = (lon + 180) * (Math.PI / 180);
                            const r = RADIUS;
                            const px = -r * Math.sin(phi) * Math.cos(theta);
                            const py = r * Math.cos(phi);
                            const pz = r * Math.sin(phi) * Math.sin(theta);
                            positions.push(px, py, pz);
                        }
                    }
                }

                const dotGeo = new THREE.BufferGeometry();
                dotGeo.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
                const dotMat = new THREE.PointsMaterial({
                    size: 0.05,
                    color: 0x4da6ff,
                    transparent: true,
                    opacity: 0.8,
                    blending: THREE.AdditiveBlending
                });
                const dots = new THREE.Points(dotGeo, dotMat);
                earthGroup.add(dots);
            };

            // 3. Grid Lines
            const wireGeo = new THREE.WireframeGeometry(new THREE.SphereGeometry(RADIUS, 24, 24));
            const wireMat = new THREE.LineBasicMaterial({ color: 0x225577, transparent: true, opacity: 0.15 });
            const lines = new THREE.LineSegments(wireGeo, wireMat);
            earthGroup.add(lines);

            // 4. Atmosphere Glow
            const vShader = `
                varying vec3 vNormal;
                void main() {
                    vNormal = normalize(normalMatrix * normal);
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `;
            const fShader = `
                varying vec3 vNormal;
                void main() {
                    float intensity = pow(0.4 - dot(vNormal, vec3(0, 0, 1.0)), 4.0);
                    gl_FragColor = vec4(0.2, 0.6, 1.0, 0.5) * intensity;
                }
            `;
            const glowMesh = new THREE.Mesh(
                new THREE.SphereGeometry(RADIUS + 1.25, 64, 64),
                new THREE.ShaderMaterial({
                    vertexShader: vShader,
                    fragmentShader: fShader,
                    side: THREE.BackSide,
                    blending: THREE.AdditiveBlending,
                    transparent: true
                })
            );
            earthGroup.add(glowMesh);

            // Function to add location marker
            let locationMarker = null;
            function addLocationMarker(lat, lon) {
                // Remove existing marker if any
                if (locationMarker) {
                    earthGroup.remove(locationMarker);
                }

                // Convert lat/lon to 3D coordinates
                const phi = (90 - lat) * (Math.PI / 180);
                const theta = (lon + 180) * (Math.PI / 180);
                const markerRadius = RADIUS + 0.1;
                
                const x = -markerRadius * Math.sin(phi) * Math.cos(theta);
                const y = markerRadius * Math.cos(phi);
                const z = markerRadius * Math.sin(phi) * Math.sin(theta);

                // Create marker group
                locationMarker = new THREE.Group();

                // Glowing sphere marker
                const markerGeometry = new THREE.SphereGeometry(0.15, 16, 16);
                const markerMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00d4aa,
                    transparent: true,
                    opacity: 0.9
                });
                const marker = new THREE.Mesh(markerGeometry, markerMaterial);
                locationMarker.add(marker);

                // Outer glow ring
                const ringGeometry = new THREE.RingGeometry(0.2, 0.3, 32);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: 0x89E5FC,
                    transparent: true,
                    opacity: 0.4,
                    side: THREE.DoubleSide
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.lookAt(new THREE.Vector3(x, y, z).normalize());
                locationMarker.add(ring);

                // Pulsing glow
                const glowGeometry = new THREE.SphereGeometry(0.25, 16, 16);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: 0x89E5FC,
                    transparent: true,
                    opacity: 0.3,
                    blending: THREE.AdditiveBlending
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                locationMarker.add(glow);

                // Position the marker
                locationMarker.position.set(x, y, z);
                earthGroup.add(locationMarker);

                // Animate marker pulsing
                let pulseTime = 0;
                function animateMarker() {
                    if (locationMarker && locationMarker.parent) {
                        pulseTime += 0.05;
                        const scale = 1 + Math.sin(pulseTime) * 0.2;
                        glow.scale.set(scale, scale, scale);
                        ring.scale.set(scale * 0.8, scale * 0.8, 1);
                        glow.material.opacity = 0.3 + Math.sin(pulseTime) * 0.2;
                    }
                }
                
                // Store animation function for later use
                locationMarker.userData.animate = animateMarker;
            }

            // Mouse interaction variables
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            let rotationVelocity = { x: 0, y: 0 };
            const damping = 0.95;

            // Mouse event listeners
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
                rotationVelocity = { x: 0, y: 0 };
            });

            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - previousMousePosition.x;
                    const deltaY = e.clientY - previousMousePosition.y;
                    
                    rotationVelocity.y = deltaX * 0.005;
                    rotationVelocity.x = deltaY * 0.005;
                    
                    earthGroup.rotation.y += rotationVelocity.y;
                    earthGroup.rotation.x += rotationVelocity.x;
                    
                    previousMousePosition = { x: e.clientX, y: e.clientY };
                }
            });

            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });

            renderer.domElement.addEventListener('mouseleave', () => {
                isDragging = false;
            });

            // Touch events for mobile
            renderer.domElement.addEventListener('touchstart', (e) => {
                isDragging = true;
                const touch = e.touches[0];
                previousMousePosition = { x: touch.clientX, y: touch.clientY };
                rotationVelocity = { x: 0, y: 0 };
            });

            renderer.domElement.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - previousMousePosition.x;
                    const deltaY = touch.clientY - previousMousePosition.y;
                    
                    rotationVelocity.y = deltaX * 0.005;
                    rotationVelocity.x = deltaY * 0.005;
                    
                    earthGroup.rotation.y += rotationVelocity.y;
                    earthGroup.rotation.x += rotationVelocity.x;
                    
                    previousMousePosition = { x: touch.clientX, y: touch.clientY };
                }
            });

            renderer.domElement.addEventListener('touchend', () => {
                isDragging = false;
            });

            // Animation with inertia
            function animate() {
                requestAnimationFrame(animate);
                
                // Apply inertia when not dragging
                if (!isDragging) {
                    earthGroup.rotation.y += rotationVelocity.y;
                    earthGroup.rotation.x += rotationVelocity.x;
                    
                    // Apply damping
                    rotationVelocity.x *= damping;
                    rotationVelocity.y *= damping;
                }
                
                // Animate location marker if it exists
                if (locationMarker && locationMarker.userData.animate) {
                    locationMarker.userData.animate();
                }
                
                renderer.render(scene, camera);
            }
            animate();

            // Expose addLocationMarker to global scope
            window.addLocationMarker = addLocationMarker;

            // Resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
    </script>
    
    <!-- Trending News JavaScript -->
    <script src="{% static 'js/trending.js' %}"></script>
</body>

</html>
